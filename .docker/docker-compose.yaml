services:
  postgres:
    container_name: postgres
    image: postgres:17.6
    environment:
      - POSTGRES_USER=nihilus
      - POSTGRES_PASSWORD=nihilus
    ports:
      - "5432:5432"
    volumes:
    - ./postgres:/docker-entrypoint-initdb.d
  redis:
    container_name: redis
    image: redis:8.2.1
    ports:
    - "6379:6379"
  rabbitmq:
    container_name: rabbitmq
    image: rabbitmq:4.1.3-management
    ports:
    - "5672:5672"
    - "15672:15672"
  apisix:
    container_name: apisix
    image: apache/apisix:3.13.0-debian
    environment:
      APISIX_STAND_ALONE: "true"
    volumes:
    - ./apisix/apisix.yaml:/usr/local/apisix/conf/apisix.yaml
    - ./apisix/config.yaml:/usr/local/apisix/conf/config.yaml
    network_mode: host
  keycloak:
    container_name: keycloak
    image: quay.io/keycloak/keycloak:26.3
    environment:
      KEYCLOAK_ADMIN: "admin"
      KEYCLOAK_ADMIN_PASSWORD: "admin"
    ports:
    - "9876:8080"
    command:
    - start-dev
    - --import-realm
    volumes:
    - ./keycloak:/opt/keycloak/data/import